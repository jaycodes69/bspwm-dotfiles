# ╭─────────────────────────────────────────────────────────╮
# │                    TMUX CONFIGURATION                   │
# │                   Tokyo Night Theme                     │
# ╰─────────────────────────────────────────────────────────╯

# ===============================================================
# PREFIX & BASIC SETTINGS
# ===============================================================
unbind C-b
set -g prefix M-j
bind M-j send-prefix

# Reload configuration
bind R source-file ~/.config/tmux/tmux.conf \; display-message "󰑓 Config reloaded!"

# Shell settings
set-option -g default-shell /bin/bash
set-option -g default-command "bash --rcfile ~/.bashrc"

# ===============================================================
# BASE SETTINGS
# ===============================================================
set -g base-index 1                # Start windows at 1
set -g pane-base-index 1           # Start panes at 1
set -g renumber-windows on         # Renumber windows when closed
set -g mouse on                    # Enable mouse support
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -g escape-time 0               # No delay for escape key
set -g repeat-time 1000            # Repeat time for commands
set -g history-limit 50000         # Increase history limit
set -g display-time 4000           # Display messages longer
set -g status-interval 5           # Update status every 5 seconds
set -g focus-events on             # Enable focus events

# ===============================================================
# WINDOW & PANE MANAGEMENT
# ===============================================================
# Splitting panes
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Pane navigation (vim-like)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Pane controls
bind x kill-pane
bind c new-window -c "#{pane_current_path}"

# Window navigation
bind -n M-1 select-window -t :1
bind -n M-2 select-window -t :2
bind -n M-3 select-window -t :3
bind -n M-4 select-window -t :4
bind -n M-5 select-window -t :5
bind -n M-6 select-window -t :6
bind -n M-7 select-window -t :7
bind -n M-8 select-window -t :8
bind -n M-9 select-window -t :9

# Switch to last window
bind Tab last-window

# ===============================================================
# TOKYO NIGHT COLOR SCHEME
# ===============================================================
# Tokyo Night colors
BG_DARK="#1a1b26"
BG="#24283b"
BG_HIGHLIGHT="#292e42"
TERMINAL_BLACK="#414868"
FG="#c0caf5"
FG_DARK="#a9b1d6"
FG_GUTTER="#3b4261"
DARK3="#545c7e"
COMMENT="#565f89"
DARK5="#737aa2"
BLUE0="#3d59a1"
BLUE="#7aa2f7"
CYAN="#7dcfff"
BLUE1="#2ac3de"
BLUE2="#0db9d7"
BLUE5="#89ddff"
BLUE6="#b4f9f8"
BLUE7="#394b70"
PURPLE="#bb9af7"
MAGENTA="#bb9af7"
ORANGE="#ff9e64"
YELLOW="#e0af68"
GREEN="#9ece6a"
GREEN1="#73daca"
GREEN2="#41a6b5"
TEAL="#1abc9c"
RED="#f7768e"
RED1="#db4b4b"

# ===============================================================
# STATUS BAR CONFIGURATION
# ===============================================================
set -g status-position top
set -g status-justify left
set -g status-style "bg=default,fg=$FG"
set -g status-left-length 100
set -g status-right-length 100

# Custom battery script
set -g @battery_script "~/.config/scripts/battery-status.sh"

# Left side: Session name with icon
set -g status-left "#[bg=default,fg=$FG,bold] 󰣇 #S #[bg=default,fg=$BLUE,nobold,nounderscore,noitalics]"

# Right side: Battery + Time
set -g status-right "#[fg=$DARK5,bg=default,nobold,nounderscore,noitalics]#[fg=$FG,bg=default] #(~/.config/scripts/battery-status.sh) #[fg=$BLUE,bg=default,nobold,nounderscore,noitalics]#[fg=$BLUE,bg=default,bold] 󰥔 %H:%M "

# Window list icon

set -g window-status-format "#[fg=BLUE] "
set -g window-status-current-format "#[fg=ORANGE,bold] "
set -g window-status-current-style "bg=default"
set -g window-status-bell-style "fg=RED,bold"

# Window status style
set -g window-status-activity-style "underscore,fg=$FG,bg=$BG"
set -g window-status-separator ""
set -g window-status-style "NONE,fg=$FG,bg=$BG"

# ===============================================================
# PANE BORDERS
# ===============================================================
set -g pane-border-style "fg=$DARK3"
set -g pane-active-border-style "fg=$BLUE"
set -g pane-border-lines simple


bind g set -g status

# ===============================================================
# COPY MODE (VI-LIKE)
# ===============================================================
setw -g mode-keys vi
bind Enter copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send-keys -X cancel
bind -T copy-mode-vi H send-keys -X start-of-line
bind -T copy-mode-vi L send-keys -X end-of-line

# ===============================================================
# MESSAGE & COMMAND LINE
# ===============================================================
set -g message-style "fg=$ORANGE,bg=$BG_HIGHLIGHT"
set -g message-command-style "fg=$ORANGE,bg=$BG_HIGHLIGHT"

# ===============================================================
# POPUP & SESSION MANAGEMENT
# ===============================================================
# Session switcher
bind-key j display-popup -E "\
    tmux list-sessions -F '#{session_name}' | \
    fzf --reverse --prompt='󰅂 Switch to: ' --preview-window=hidden | \
    xargs -I{} tmux switch-client -t {}"

# Session killer
bind-key k display-popup -E "\
    tmux list-sessions -F '#{session_name}' | \
    fzf --multi --reverse --prompt='󰆴 Kill sessions: ' --preview-window=hidden | \
    xargs -r -n 1 tmux kill-session -t"

# Sessionizer script
bind-key -r f run-shell "tmux neww ~/.config/scripts/tmux-sessionizer.sh"

# ===============================================================
# PLUGINS
# ===============================================================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Plugin settings
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'

# ===============================================================
# ADDITIONAL SETTINGS
# ===============================================================
# Clock mode
setw -g clock-mode-colour $BLUE
setw -g clock-mode-style 24

# Bell
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g monitor-activity off
set -g bell-action none

# Modes
setw -g mode-style "fg=$ORANGE,bg=$BG_HIGHLIGHT,bold"

# Initialize TMUX plugin manager (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'
